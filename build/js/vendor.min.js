"use strict";var BootstrapForm=function(e,t){this.options=t||{},this.body="";try{if("string"!=typeof e||0==e.length)throw new Error("Invalid Argument: id must a non-empty string");this.id=e}catch(i){console.log("Error: "+i.message)}};BootstrapForm.prototype.form=function(){return'<form id="'+this.id+'"name="'+this.id+'"class="'+(this.options.classes||"")+'">'+this.body+'<button type="submit" class="btn btn-success">'+(this.options.submitText||"Submit")+"</button></form>"},BootstrapForm.prototype.addInput=function(e,t,i){var o=i||{};this.body+='<div class="form-group">',this.body+='<label for="'+e+'">'+(o.label||""),o.info&&(this.body+=' <a href="#" data-toggle="tooltip" data-placement="right" title="'+o.info+'"><i class="fa fa-info-circle"></i></a>'),o.helpLink&&o.helpLink.url&&(this.body+=' <a href="'+o.helpLink.url+'" target="_blank" data-toggle="tooltip" data-placement="right" title="'+(o.helpLink.title||"")+'"><i class="fa fa-question-circle"></i></a>'),this.body+="</label>",this.body+='<input id="'+e+'" name="'+e+'" type="'+t+'"',this.body+=' class="form-control '+(o.classes||"")+'"',o.placeholder&&(this.body+=' placeholder="'+o.placeholder+'"'),this.body+=">",o.help&&(this.body+='<p class="help-block">'+o.help+"</p>"),this.body+="</div>"};var CSSGRIDGENERATOR=CSSGRIDGENERATOR||{};CSSGRIDGENERATOR.grid={grid:{},gridTemplateRows:["auto"],gridTemplateColumns:["auto"],gridColumnGap:"0",gridRowGap:"0",newCellTemplate:'<li data-name=""><button type="button" data-toggle="popover" class="btn btn-default edit edit-cell"><span class="fa fa-lg fa-pencil"></span> <span class="sr-only">Edit</span></button><span class=""name""></span></li>',cols:1,rows:1,updateDimensions:function(){var e=this;this.cols=0,this.rows=0,this.grid.serialize().forEach(function(t,i){e.cols=Math.max(t.col+t.size_x-1,e.cols),e.rows=Math.max(t.row+t.size_y-1,e.rows)});for(var t=0;t<this.cols;t++)"undefined"==typeof this.gridTemplateColumns[t]&&(this.gridTemplateColumns[t]="auto");for(var i=0;i<this.rows;i++)"undefined"==typeof this.gridTemplateRows[i]&&(this.gridTemplateRows[i]="auto");this.gridTemplateColumns=this.gridTemplateColumns.slice(0,this.cols),this.gridTemplateRows=this.gridTemplateRows.slice(0,this.rows)},addCell:function(){var e=this.grid.add_widget(this.newCellTemplate,1,1);return console.log(e),console.log(typeof e),console.log(e instanceof jQuery?"jquer":"none"),e},editCell:function(){throw new Error("editCell must be overridden before use")},editRow:function(){throw new Error("editRow must be overridden before use")},editCol:function(){throw new Error("editCol must be overridden before use")},exportCSS:function(){function e(e,t){var i=t||{},o="tab"in i&&"string"==typeof i.tab?i.tab:"  ",a="newLine"in i&&"string"==typeof i.newLine?i.newLine:"\n",r="";if(e.hasOwnProperty("selector")&&e.hasOwnProperty("properties")){r=e.selector+" {"+a;for(var n in e.properties)r+=o+n+": "+e.properties[n]+";"+a;r+="}"+a}else r=void 0;return r}function t(e){var t=!0;return e.serialize().forEach(function(e,i){e.hasOwnProperty("name")&&"string"==typeof e.name&&e.name&&0!==e.name.length||(t=!1)}),t?"areas":"coords"}var i="";switch(this.updateDimensions(),t(this.grid)){case"areas":var o=[];this.grid.serialize().forEach(function(t,a){var r=t.name.match(/^[0-9]/),n=r?"\\3"+r.pop()+" "+t.name.substr(1):t.name;i+=e({selector:"#"+n,properties:{"grid-area":n}}),i+="\n";for(var s=t.col,l=t.col+t.size_x,d=t.row,c=t.row+t.size_y,p=d-1;c-1>p;p++)for(var u=s-1;l-1>u;u++)"undefined"==typeof o[p]&&(o[p]=[]),o[p][u]=t.name});for(var a="",r=0;r<this.rows;r++){a+=r>0?' "':'"';for(var n=0;n<this.cols;n++)a+=n>0?" ":"",a+="undefined"!=typeof o[r][n]?o[r][n]:".";a+='"'}i=e({selector:"#grid",properties:{display:"grid","grid-template-areas":a,"grid-template-columns":this.gridTemplateColumns.join(" "),"grid-template-rows":this.gridTemplateRows.join(" "),"grid-gap":this.gridColumnGap+" "+this.gridRowGap}})+"\n"+i;break;case"coords":this.grid.serialize().forEach(function(t,o){i+=e({selector:"#area-"+(o+1),properties:{"grid-column-start":t.col,"grid-column-end":t.col+t.size_x,"grid-row-start":t.row,"grid-row-end":t.row+t.size_y}}),i+="\n"}),i=e({selector:"#grid",properties:{display:"grid","grid-template-columns":this.gridTemplateColumns.join(" "),"grid-template-rows":this.gridTemplateRows.join(" "),"grid-gap":this.gridColumnGap+" "+this.gridRowGap}})+"\n"+i}return i}},$(function(){var e=17,t=10,i=$("body").innerWidth()-e-t,o=15,a=12;i-=24*o;var r=Math.floor(i/a),n='<style type="text/css">.index.index-col li {width: '+r+"px;margin-left: "+o+"px;margin-right: "+o+"px;}.index.index-row li {height: "+(r+2*o)+"px;line-height: "+r+"px;padding-top: "+o+"px;padding-left: "+t+"px;padding-bottom: "+o+"px;}</style>";$("head").append(n),$("#grid").gridster({widget_margins:[o,o],widget_base_dimensions:[r,r],serialize_params:function(e,t){var i={col:t.col,row:t.row,extra_cols:0,size_x:t.size_x,size_y:t.size_y,name:t.el.data("name")};return i},resize:{enabled:!0}}),CSSGRIDGENERATOR.grid.grid=$("#grid").gridster().data("gridster"),CSSGRIDGENERATOR.grid.grid.set_dom_grid_width=function(e){Gridster.prototype.set_dom_grid_width.call(this,e),"undefined"==typeof e&&(e=this.get_highest_occupied_cell().col);var t=this.options.autogrow_cols?this.options.max_cols:this.cols;return e=Math.min(t,Math.max(e,this.options.min_cols)),$("#index-col li").each(function(t){$(this).css("display",e>t?"block":"none")}),this},CSSGRIDGENERATOR.grid.grid.set_dom_grid_height=function(e){if(Gridster.prototype.set_dom_grid_height.call(this,e),"undefined"==typeof e){var t=this.get_highest_occupied_cell().row;e=t*this.min_widget_height}var i=r+2*o,a=e/i;return $("#index-row li").each(function(e){$(this).css("display",a>e?"block":"none")}),this};var s={animation:"fade",closeable:!0,cache:"false",trigger:"manual",backdrop:!0},l="editCol-",d="editForm-";CSSGRIDGENERATOR.grid.attachEditCellPopover=function(e){console.log(e),$(e).webuiPopover($.extend({title:"Edit Cell",content:function(){var e=$(this).parent().data("row")+"-"+$(this).parent().data("col"),t=new BootstrapForm(d+"Cell-"+e,{submitText:"Save"});return t.addInput(l+"name","text",{label:"Name",info:"Valid value: <custom-ident> as defined by the W3 CSS Grid Specification.",helpLink:{url:"http://www.w3.org/TR/css-grid-1/#track-sizing",title:"Open W3 Specification"}}),t.form()+'<button id="deleteCell-'+e+'" class="btn btn-danger">Delete</button>'}},s))},CSSGRIDGENERATOR.grid.attachEditColPopover=function(e){$(e).webuiPopover($.extend({title:"Edit Column",content:function(){var e=$(this).parent().data("col"),t=new BootstrapForm(d+"Column-"+e,{submitText:"Save"});return t.addInput(l+"gridTemplateColumn-"+e,"text",{label:"Width",info:"Valid values: <length>, <percentage>, <flex>, max-content, min-content, minmax(min, max), and auto as defined by the W3 CSS Grid Specification.",helpLink:{url:"http://www.w3.org/TR/css-grid-1/#track-sizing",title:"Open W3 Specification"}}),t.addInput(l+"gridColumnGap","text",{label:"Gap",help:"The horizontal space between columns. This is the same for all columns.",info:"Valid value: <length> as defined by the W3 CSS Grid Specification.",helpLink:{url:"http://www.w3.org/TR/css-grid-1/#gutters",title:"Open W3 Specification"}}),t.form()}},s))},CSSGRIDGENERATOR.grid.attachEditRowPopover=function(e){$(e).webuiPopover($.extend({title:"Edit Row",content:function(){var e=$(this).parent().data("row"),t=new BootstrapForm(d+"Row-"+e,{submitText:"Save"});return t.addInput(l+"gridTemplateRow-"+e,"text",{label:"Width",info:"Valid values: <length>, <percentage>, <flex>, max-content, min-content, minmax(min, max), and auto as defined by the W3 CSS Grid Specification.",helpLink:{url:"http://www.w3.org/TR/css-grid-1/#track-sizing",title:"Open W3 Specification"}}),t.addInput(l+"gridRowGap","text",{label:"Gap",help:"The vertical space between rows. This is the same for all rows.",info:"Valid value: <length> as defined by the W3 CSS Grid Specification.",helpLink:{url:"http://www.w3.org/TR/css-grid-1/#gutters",title:"Open W3 Specification"}}),t.form()}},s))},$("#index-col li .edit").each(function(e,t){CSSGRIDGENERATOR.grid.attachEditColPopover(t)}),$("#index-row li .edit").each(function(e,t){CSSGRIDGENERATOR.grid.attachEditRowPopover(t)}),$("#grid li .edit").each(function(e,t){CSSGRIDGENERATOR.grid.attachEditCellPopover(t)}),$("#addCell").click(function(){var e=CSSGRIDGENERATOR.grid.addCell(),t=$(e),i='li[data-row="'+t.data("row")+'"][data-col="'+t.data("col")+'"] .edit';console.log(i),CSSGRIDGENERATOR.grid.attachEditCellPopover(i)}),CSSGRIDGENERATOR.grid.editCell=function(e){console.log(e),console.log($(e));var t=$(e);t.webuiPopover("show");var i=$(e).parent().data("row")+"-"+$(e).parent().data("col");$('[data-toggle="tooltip"]').tooltip(),CSSGRIDGENERATOR.grid.updateDimensions(),$("#"+d+"Cell-"+i+" input").val(t.parent().data("name"));var o={rules:{},submitHandler:function(e,i){for(var o=$(e).serializeArray(),a=0;a<o.length;a++){var r=o[a].name.replace(l,"");t.parent().data(r,o[a].value.trim())}t.parent().children(".name").html(t.parent().data("name")),$("#alerts").html('<div class="alert alert-success alert-dismissible fade in" role="alert"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Success!</strong> The grid has been updated successfully.</div>'),t.webuiPopover("hide")}},a=/^\s*[0-9a-zA-Z-_]+\s*$/;o.rules[l+"name"]={pattern:a},$(".webui-popover-backdrop").off("click").on("click",function(){t.webuiPopover("hide")}),$("#deleteCell-"+i).click(function(){t.webuiPopover("destroy"),CSSGRIDGENERATOR.grid.grid.remove_widget(t.parent(),function(){})}),console.log("#"+d+"Cell-"+i),$("#"+d+"Cell-"+i).submit(function(e){e.preventDefault()}).validate(o)};var c=/^\s*(auto|0)$|^[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc)$\s*/,p=/^\s*((auto|0)|[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc)|max-content|min-content|[0-9]+fr|minmax\(\s*((auto|0)|[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc)|max-content|min-content|[0-9]+fr)\s*,\s*((auto|0)|[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc)|max-content|min-content|[0-9]+fr)\s*\))\s*$/;CSSGRIDGENERATOR.grid.editCol=function(e){var t=$(e);t.webuiPopover("show");var i=$(e).parent().data("col");$('[data-toggle="tooltip"]').tooltip(),CSSGRIDGENERATOR.grid.updateDimensions(),$("#"+d+"Column-"+i+" input").each(function(){var e=$(this)[0].id.replace(l,"");if(e.match(/Template/)){var t=e.match(/[0-9]+/);e=e.replace(/-[0-9]+/,"")+"s",$(this).val(CSSGRIDGENERATOR.grid[e][t.pop()])}else e.match(/Gap/)&&$(this).val(CSSGRIDGENERATOR.grid[e])});var o={rules:{},submitHandler:function(e,i){for(var o=$(e).serializeArray(),a=0;a<o.length;a++){var r=o[a].name.replace(l,"");if(r.match(/Gap/))CSSGRIDGENERATOR.grid[r]=o[a].value;else if(r.match(/Template/)){var n=r.match(/[0-9]+/);r=r.replace(/-[0-9]+/,""),r=r.replace(/-[0-9]+/,"")+"s",CSSGRIDGENERATOR.grid[r][n.pop()]=o[a].value}}$("#alerts").html('<div class="alert alert-success alert-dismissible fade in" role="alert"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Success!</strong> The grid has been updated successfully.</div>'),t.webuiPopover("hide")}};o.rules[l+"gridTemplateColumn-"+i]={pattern:p},o.rules[l+"gridColumnGap"]={pattern:c},$(".webui-popover-backdrop").off("click").on("click",function(){t.webuiPopover("hide")}),$("#"+d+"Column-"+i).submit(function(e){e.preventDefault()}).validate(o)},CSSGRIDGENERATOR.grid.editRow=function(e){var t=$(e);t.webuiPopover("show");var i=$(e).parent().data("row");$('[data-toggle="tooltip"]').tooltip(),CSSGRIDGENERATOR.grid.updateDimensions(),$("#"+d+"Row-"+i+" input").each(function(){var e=$(this)[0].id.replace(l,"");if(e.match(/Template/)){var t=e.match(/[0-9]+/);e=e.replace(/-[0-9]+/,"")+"s",$(this).val(CSSGRIDGENERATOR.grid[e][t.pop()])}else e.match(/Gap/)&&$(this).val(CSSGRIDGENERATOR.grid[e])});var o={rules:{},submitHandler:function(e,i){for(var o=$(e).serializeArray(),a=0;a<o.length;a++){var r=o[a].name.replace(l,"");if(r.match(/Gap/))CSSGRIDGENERATOR.grid[r]=o[a].value;else if(r.match(/Template/)){var n=r.match(/[0-9]+/);r=r.replace(/-[0-9]+/,""),r=r.replace(/-[0-9]+/,"")+"s",CSSGRIDGENERATOR.grid[r][n.pop()]=o[a].value}}$("#alerts").html('<div class="alert alert-success alert-dismissible fade in" role="alert"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Success!</strong> The grid has been updated successfully.</div>'),t.webuiPopover("hide")}};o.rules[l+"gridTemplateRow-"+i]={pattern:p},o.rules[l+"gridRowGap"]={pattern:c},$(".webui-popover-backdrop").off("click").on("click",function(){t.webuiPopover("hide")}),$("#"+d+"Row-"+i).submit(function(e){e.preventDefault()}).validate(o)},$("#grid").on("click",'button[data-toggle="popover"].edit',function(){CSSGRIDGENERATOR.grid.editCell(this)}),$("#index-row").on("click",'button[data-toggle="popover"].edit',function(){CSSGRIDGENERATOR.grid.editRow(this)}),$("#index-col").on("click",'button[data-toggle="popover"].edit',function(){CSSGRIDGENERATOR.grid.editCol(this)}),$("#export").click(function(){$("#exportModal .modal-body").html(CSSGRIDGENERATOR.grid.exportCSS()),$("#exportModal").modal("show")})}),String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};